<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel - Ürün Yönetimi (TR/DE + Resim)</title>

  <!-- Firebase compat sürümleri -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    :root { --bg:#0b1220; --card:#111a2b; --soft:#1a2440; --txt:#e9edf3; --muted:#9fb0d1; --accent:#4aa3ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Arial, sans-serif; background:var(--bg); color:var(--txt); }
    header { padding:20px; border-bottom:1px solid #1e2a44; display:flex; align-items:center; gap:10px; }
    header h1 { font-size:20px; margin:0; }
    main { max-width:900px; margin:24px auto; padding:0 16px 48px; }
    .card { background:var(--card); border:1px solid #1e2a44; border-radius:14px; padding:18px; }
    .grid { display:grid; gap:16px; }
    .grid-2 { grid-template-columns: 1fr 1fr; }
    label { display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    input[type="text"], input[type="email"], input[type="password"], input[type="file"] {
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #223152; background:var(--soft); color:var(--txt);
    }
    button { border:0; border-radius:10px; padding:10px 14px; background:var(--accent); color:#001228; font-weight:700; cursor:pointer; }
    button.secondary { background:#203257; color:#e2ecff; }
    .list { list-style:none; padding:0; margin:0; }
    .list li { background:#0e1629; border:1px solid #1e2a44; padding:12px; border-radius:12px; margin-bottom:10px; display:flex; gap:12px; align-items:center; }
    .list img { width:64px; height:64px; object-fit:cover; border-radius:8px; border:1px solid #1f2b47; }
    .row { display:flex; gap:10px; align-items:center; }
    .right { margin-left:auto; }
  </style>
</head>
<body>
  <header>
    <h1>Admin Panel (TR & DE)</h1>
  </header>

  <main>
    <!-- Giriş -->
    <section id="loginCard" class="card grid">
      <h2>Giriş</h2>
      <div class="grid grid-2">
        <div>
          <label for="email">E‑posta</label>
          <input id="email" type="email" placeholder="ornek@site.com" />
        </div>
        <div>
          <label for="password">Şifre</label>
          <input id="password" type="password" placeholder="En az 6 karakter" />
        </div>
      </div>
      <div class="row">
        <button id="btnLogin">Giriş Yap</button>
        <button id="btnLogout" class="secondary" style="display:none;">Çıkış Yap</button>
        <span id="authStatus"></span>
      </div>
    </section>

    <br/>

    <!-- Ürün Ekle -->
    <section id="formCard" class="card" style="display:none;">
      <h2>Ürün Ekle</h2>
      <div class="grid grid-2">
        <div>
          <label for="adTR">Ürün Adı (Türkçe)</label>
          <input id="adTR" type="text" />
        </div>
        <div>
          <label for="adDE">Produktname (Deutsch)</label>
          <input id="adDE" type="text" />
        </div>
        <div>
          <label for="fiyat">Fiyat</label>
          <input id="fiyat" type="text" />
        </div>
        <div>
          <label for="resim">Ürün Resmi</label>
          <input id="resim" type="file" accept="image/*" />
        </div>
      </div>
      <button id="btnAdd">Ürünü Ekle</button>
      <span id="addStatus"></span>
    </section>

    <br/>

    <!-- Ürün Listesi -->
    <section id="listCard" class="card" style="display:none;">
      <h2>Ürünler</h2>
      <button id="btnRefresh" class="secondary right">Yenile</button>
      <ul id="urunListesi" class="list"></ul>
      <p id="emptyMsg" style="display:none;">Henüz ürün yok.</p>
    </section>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCOGoE0f0gywYGrZCMcQfUE6ikf-4X7x1k",
      authDomain: "gis-nwr-website.firebaseapp.com",
      projectId: "gis-nwr-website",
      storageBucket: "gis-nwr-website.appspot.com",
      messagingSenderId: "654148719639",
      appId: "1:654148719639:web:b7cd23a784ceff9cea3852",
      measurementId: "G-1KMLFGBXWP"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const loginCard = document.getElementById("loginCard");
    const formCard  = document.getElementById("formCard");
    const listCard  = document.getElementById("listCard");
    const emailEl   = document.getElementById("email");
    const passEl    = document.getElementById("password");
    const btnLogin  = document.getElementById("btnLogin");
    const btnLogout = document.getElementById("btnLogout");
    const authStatus= document.getElementById("authStatus");
    const adTR      = document.getElementById("adTR");
    const adDE      = document.getElementById("adDE");
    const fiyat     = document.getElementById("fiyat");
    const resim     = document.getElementById("resim");
    const btnAdd    = document.getElementById("btnAdd");
    const addStatus = document.getElementById("addStatus");
    const btnRefresh= document.getElementById("btnRefresh");
    const ul        = document.getElementById("urunListesi");
    const emptyMsg  = document.getElementById("emptyMsg");

    auth.onAuthStateChanged((user) => {
      if (user) {
        authStatus.textContent = "Giriş yapıldı: " + (user.email || "");
        btnLogin.style.display = "none";
        btnLogout.style.display = "inline-block";
        formCard.style.display = "block";
        listCard.style.display = "block";
        loadProducts();
      } else {
        authStatus.textContent = "Giriş bekleniyor...";
        btnLogin.style.display = "inline-block";
        btnLogout.style.display = "none";
        formCard.style.display = "none";
        listCard.style.display = "none";
        ul.innerHTML = "";
      }
    });

    btnLogin.addEventListener("click", () => {
      const email = emailEl.value.trim();
      const pass  = passEl.value.trim();
      if (!email || !pass) { authStatus.textContent = "E‑posta ve şifre zorunlu."; return; }
      auth.signInWithEmailAndPassword(email, pass)
        .then(() => { authStatus.textContent = "Giriş başarılı."; })
        .catch(err => { authStatus.textContent = "Hata: " + err.message; });
    });

    btnLogout.addEventListener("click", () => { auth.signOut(); });

    btnAdd.addEventListener("click", async () => {
      const tr = adTR.value.trim();
      const de = adDE.value.trim();
      const pr = fiyat.value.trim();
      const file = resim.files[0];
      if (!tr || !de || !pr) { addStatus.textContent = "Tüm alanları doldurun."; return; }
      if (!file) { addStatus.textContent = "Resim seçin."; return; }
      addStatus.textContent = "Yükleniyor...";
      try {
        const path = "urunler/" + Date.now() + "_" + file.name;
        const ref  = storage.ref(path);
        await ref.put(file);
        const url  = await ref.getDownloadURL();
        await db.collection("urunler").add({ ad_tr: tr, ad_de: de, fiyat: pr, resim: url, ts: new Date() });
        addStatus.textContent = "Ürün eklendi.";
        adTR.value = ""; adDE.value = ""; fiyat.value = ""; resim.value = "";
        loadProducts();
      } catch (e) {
        addStatus.textContent = "Hata: " + e.message;
      }
    });

    async function loadProducts() {
      ul.innerHTML = "";
      const snap = await db.collection("urunler").orderBy("ts","desc").get();
      if (snap.empty) { emptyMsg.style.display = "block"; return; }
      emptyMsg.style.display = "none";
      snap.forEach(doc => {
        const d = doc.data();
        const li = document.createElement("li");
        li.innerHTML = \`
          <img src="\${d.resim || ""}" alt="resim" />
          <div>
            <div><b>\${d.ad_tr || ""}</b> / \${d.ad_de || ""}</div>
            <div>\${d.fiyat || ""}</div>
          </div>
          <button onclick="sil('\${doc.id}')">Sil</button>
        \`;
        ul.appendChild(li);
      });
    }

    btnRefresh.addEventListener("click", loadProducts);

    async function sil(id) {
      if (!confirm("Silmek istiyor musunuz?")) return;
      try { await db.collection("urunler").doc(id).delete(); loadProducts(); }
      catch(e){ alert("Silme hatası: " + e.message); }
    }
    window.sil = sil;
  </script>
</body>
</html>
